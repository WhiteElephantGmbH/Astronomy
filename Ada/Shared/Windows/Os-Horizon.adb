-- *********************************************************************************************************************
-- *                           (c) 2022 by White Elephant GmbH, Schaffhausen, Switzerland                              *
-- *                                               www.white-elephant.ch                                               *
-- *********************************************************************************************************************
pragma Style_White_Elephant;

with Os.Process;
with Log;

package body Os.Horizon is

  function Result_Of_Get_With (Item : Arguments) return String is

    Url : constant String := "https://ssd.jpl.nasa.gov/api/horizons.api"
                           & "?MAKE_EPHEM=YES"
                           & "&COMMAND='" & Item(1) & "'"
                           & "&EPHEM_TYPE=OBSERVER"
                           & "&CENTER='coord@399'"
                           & "&COORD_TYPE=GEODETIC"
                           & "&SITE_COORD='" & Item(2) & "'"
                           & "&START_TIME='" & Item(3) & "'"
                           & "&STOP_TIME='" & Item(4) & "'"
                           & "&STEP_SIZE='" & Item(5) & "'"
                           & "&QUANTITIES='1'"
                           & "&REF_SYSTEM=ICRF"
                           & "&CAL_FORMAT=BOTH"
                           & "&TIME_DIGITS=MINUTES"
                           & "&ANG_FORMAT=DEG"
                           & "&APPARENT=AIRLESS"
                           & "&RANGE_UNITS=AU"
                           & "&SUPPRESS_RANGE_RATE=NO"
                           & "&ELEV_CUT='0'"
                           & "&SKIP_DAYLT=NO"
                           & "&SOLAR_ELONG='0,180'"
                           & "&EXTRA_PREC=NO"
                           & "&R_T_S_ONLY=NO"
                           & "&CSV_FORMAT=YES"
                           & "&OBJ_DATA=NO";

    pragma Style_Checks ("M2000");
    --Data : constant String := "{""signature"":{""source"":""NASA/JPL Horizons API"",""version"":""1.1""},""result"":""*******************************************************************************\nJPL/DASTCOM            Small-body Index Search Results     2022-Feb-26 05:29:33\n\n Comet and asteroid index search:\n\n   NAME = BORRELLY;\n\n Matching small-bodies: \n\n    record #  Epoch-yr  Primary Desig  >MATCH NAME<\n    --------  --------  -------------  -------------------------\n        1539            1940 UB         Borrelly\n    90000292    1905    19P             Borrelly\n    90000293    1911    19P             Borrelly\n    90000294    1918    19P             Borrelly\n    90000295    1925    19P             Borrelly\n    90000296    1932    19P             Borrelly\n    90000297    1953    19P             Borrelly\n    90000298    1960    19P             Borrelly\n    90000299    1967    19P             Borrelly\n    90000300    1974    19P             Borrelly\n    90000301    1981    19P             Borrelly\n    90000302    1987    19P             Borrelly\n    90000303    1994    19P             Borrelly\n    90000304    2004    19P             Borrelly\n    90000305    2015    19P             Borrelly\n    90001642    1873    C/1873 Q1       Borrelly\n    90001647    1874    C/1874 O1       Borrelly\n    90001649    1874    C/1874 X1       Borrelly\n    90001650    1877    C/1877 C1       Borrelly\n    90001697    1890    C/1889 X1       Borrelly\n    90001737    1903    C/1903 M1       Borrelly\n    90001760    1912    C/1912 V1       Borrelly\n\n (22 matches. To SELECT, enter record # (integer), followed by semi-colon.)\n*******************************************************************************\n""}";
      Data : constant String := "{""signature"":{""source"":""NASA/JPL Horizons API"",""version"":""1.1""},""result"":""\n\n*******************************************************************************\nEphemeris / API_USER Sun Feb 27 02:34:58 2022 Pasadena, USA      / Horizons    \n*******************************************************************************\nTarget body name: 19P/Borrelly                    {source: JPL#K223/16}\nCenter body name: Earth (399)                     {source: DE441}\nCenter-site name: (user defined site below)\n*******************************************************************************\nStart time      : A.D. 2022-Feb-28 00:00:00.0000 UT      \nStop  time      : A.D. 2022-Mar-06 00:00:00.0000 UT      \nStep-size       : 60 minutes\n*******************************************************************************\nTarget pole/equ : IAU                             {West-longitude positive}\nTarget radii    : 4.2 x 4.2 x 4.2 km              {Equator, meridian, pole}    \nCenter geodetic : 8.60986389,47.7055028,0.5400000 {E-lon(deg),Lat(deg),Alt(km)}\nCenter cylindric: 8.60986389,4300.35861,4695.3030 {E-lon(deg),Dxy(km),Dz(km)}\nCenter pole/equ : ITRF93                          {East-longitude positive}\nCenter radii    : 6378.1 x 6378.1 x 6356.8 km     {Equator, meridian, pole}    \nTarget primary  : Sun\nVis. interferer : MOON (R_eq= 1737.400) km        {source: DE441}\nRel. light bend : Sun, EARTH                      {source: DE441}\nRel. lght bnd GM: 1.3271E+11, 3.9860E+05 km^3/s^2                              \nSmall-body perts: Yes                             {source: SB441-N16}\nAtmos refraction: NO (AIRLESS)\nRA format       : DEG\nTime format     : BOTH\nEOP file        : eop.220224.p220520                                           \nEOP coverage    : " &
                                "DATA-BASED 1962-JAN-20 TO 2022-FEB-24. PREDICTS-> 2022-MAY-19\nUnits conversion: 1 au= 149597870.700 km, c= 299792.458 km/s, 1 day= 86400.0 s \nTable cut-offs 1: Elevation (  0.0deg=YES),Airmass (>38.000=NO), Daylight (NO )\nTable cut-offs 2: Solar elongation (  0.0,180.0=NO ),Local Hour Angle( 0.0=NO )\nTable cut-offs 3: RA/DEC angular rate (     0.0=NO )                           \nTable format    : Comma Separated Values (spreadsheet)\n*******************************************************************************\nInitial IAU76/J2000 heliocentric ecliptic osculating elements (au, days, deg.):\n  EPOCH=  2457327.5 ! 2015-Nov-01.0000000 (TDB)    RMSW= n.a.                  \n   EC= .6255252336630632   QR= 1.348967938383417   TP= 2457171.4290104038      \n   OM= 75.37057418961703   W= 353.468989155228     IN= 30.3664103260908        \n  Equivalent ICRF heliocentric cartesian coordinates (au, au/d):\n   X=-1.699124795314250E+00  Y= 2.728236330300595E-01  Z= 1.291400644819463E+00\n  VX=-1.011936289716406E-02 VY=-9.481463404125036E-03 VZ= 7.896362130452054E-04\nComet physical (GM= km^3/s^2; RAD= km):" &
                                "                                        \n   GM= n.a.                RAD= 2.4                                            \n   M1=  9.6      M2=  13.7     k1=  16.    k2=  5.      PHCOF=  .030           \nComet non-gravitational force model (AMRAT=m^2/kg;A1-A3=au/d^2;DT=days;R0=au): \n   AMRAT=  0.                                      DT=  0.                     \n   A1= 1.057055145502E-9   A2= -3.948810696602E-10 A3= 0.                      \n Standard model:                                                               \n   ALN=  .1112620426   NK=  4.6142   NM=  2.15     NN=  5.093    R0=  2.808    \n*******************************************************************************\n Date__(UT)__HR:MN, Date_________JDUT, , , R.A._(ICRF), DEC_(ICRF),\n*******************************************************************\n$$SOE\n\n>..... Elevation Cut-off Requested .....<\n\n 2022-Feb-28 08:00, 2459638.833333333,*,m,    39.72117,   22.19149,\n 2022-Feb-28 09:00, 2459638.875000000,*,m,    39.75196,   22.21580,\n 2022-Feb-28 10:00, 2459638.916666667,*,m,    39.78269,   22.24010,\n 2022-Feb-28 11:00, 2459638.958333333,*,m,    39.81333,   22.26439,\n 2022-Feb-28 12:00, 2459639.000000000,*,m,    39.84391,   22.28865,\n 2022-Feb-28 13:00, 2459639.041666667,*,m,    39.87443,   22.31289,\n 2022-Feb-28 14:00, 2459639.083333333,*,m,    39.90490,   22.33709,\n 2022-Feb-28 15:00, 2459639.125000000,*, ,    39.93535,   22.36125,\n 2022-Feb-28 16:00, 2459639.166666667,*, ,    39.96580,   22.38537,\n 2022-Feb-28 17:00, 2459639.208333333,*, ,    39.99627,   22.40945,\n 2022-Feb-28 18:00, 2459639.250000000,N, ,    40.02678,   22.43349,\n 2022-Feb-28 19:00, 2459639.291666667, , ,    40.05735,   22.45749,\n 2022-Feb-28 20:00, 2459639.333333333, , ,    40.08800,   22.48146,\n 2022-Feb-28 21:00, 2459639.375000000, ," &
                                " ,    40.11873,   22.50541,\n 2022-Feb-28 22:00, 2459639.416666667, , ,    40.14956,   22.52934,\n 2022-Feb-28 23:00, 2459639.458333333, , ,    40.18048,   22.55327,\n\n>..... Elevation Cut-off Requested .....<\n\n 2022-Mar-01 08:00, 2459639.833333333,*,m,    40.46082,   22.76906,\n 2022-Mar-01 09:00, 2459639.875000000,*,m,    40.49184,   22.79309,\n 2022-Mar-01 10:00, 2459639.916666667,*,m,    40.52279,   22.81711,\n 2022-Mar-01 11:00, 2459639.958333333,*,m,    40.55367,   22.84112,\n 2022-Mar-01 12:00, 2459640.000000000,*,m,    40.58448,   22.86511,\n 2022-Mar-01 13:00, 2459640.041666667,*,m,    40.61523,   22.88906,\n 2022-Mar-01 14:00, 2459640.083333333,*,m,    40.64593,   22.91298,\n 2022-Mar-01 15:00, 2459640.125000000,*,m,    40.67661,   22.93686,\n 2022-Mar-01 16:00, 2459640.166666667,*, ,    40.70729,   22.96070,\n 2022-Mar-01 17:00, 2459640.208333333,*, ,    40.73799,   22.98449,\n 2022-Mar-01 18:00, 2459640.250000000,N, ,    40.76873,   23.00825,\n 2022-Mar-01 19:00, 2459640.291666667, , ,    40.79954,   23.03196,\n 2022-Mar-01 20:00, 2459640.333333333, , ,    40.83042,   23.05565,\n 2022-Mar-01 21:00, 2459640.375000000, , ,    40.86138,   23.07931,\n 2022-Mar-01 22:00, 2459640.416666667, , ,    40.89245,   23.10296,\n 2022-Mar-01 23:00, 2459640.458333333, , ,    40.92360,   23.12659,\n\n>..... Elevation Cut-off Requested .....<\n\n 2022-Mar-02 08:00, 2459640.833333333,*,m,    41.20602,   23.33982,\n 2022-Mar-02 09:00, 2459640.875000000,*,m,    41.23727,   23.36357,\n 2022-Mar-02 10:00, 2459640.916666667,*,m,    41.26846,   23.38731,\n 2022-Mar-02 11:00, 2459640.958333333,*,m,    41.29956,   23.41103,\n 2022-Mar-02 12:00, 2459641.000000000,*,m,    41.33060,   23.43473,\n 2022-Mar-02 13:00, 2459641.041666667,*,m,    41.36158,   23.45840,\n 2022-Mar-02 14:00, 2459641.083333333,*,m," &
                                "    41.39252,   23.48204,\n 2022-Mar-02 15:00, 2459641.125000000,*,m,    41.42343,   23.50563,\n 2022-Mar-02 16:00, 2459641.166666667,*,m,    41.45434,   23.52918,\n 2022-Mar-02 17:00, 2459641.208333333,*, ,    41.48528,   23.55268,\n 2022-Mar-02 18:00, 2459641.250000000,N, ,    41.51625,   23.57615,\n 2022-Mar-02 19:00, 2459641.291666667, , ,    41.54729,   23.59957,\n 2022-Mar-02 20:00, 2459641.333333333, , ,    41.57840,   23.62297,\n 2022-Mar-02 21:00, 2459641.375000000, , ,    41.60960,   23.64634,\n 2022-Mar-02 22:00, 2459641.416666667, , ,    41.64090,   23.66970,\n 2022-Mar-02 23:00, 2459641.458333333, , ,    41.67229,   23.69304,\n\n>..... Elevation Cut-off Requested .....<\n\n 2022-Mar-03 08:00, 2459641.833333333,*,m,    41.95680,   23.90367,\n 2022-Mar-03 09:00, 2459641.875000000,*,m,    41.98829,   23.92713,\n 2022-Mar-03 10:00, 2459641.916666667,*,m,    42.01970,   23.95058,\n 2022-Mar-03 11:00, 2459641.958333333,*,m,    42.05104,   23.97401,\n 2022-Mar-03 12:00, 2459642.000000000,*,m,    42.08231,   23.99743,\n 2022-Mar-03 13:00, 2459642.041666667,*,m,    42.11352,   24.02080,\n 2022-Mar-03 14:00, 2459642.083333333,*,m,    42.14469,   24.04415,\n 2022-Mar-03 15:00, 2459642.125000000,*,m,    42.17584,   24.06745,\n 2022-Mar-03 16:00, 2459642.166666667,*,m,    42.20699,   24.09070,\n 2022-Mar-03 17:00, 2459642.208333333,*,m,    42.23815,   24.11392,\n 2022-Mar-03 18:00, 2459642.250000000,N,m,    42.26936,   24.13709,\n 2022-Mar-03 19:00, 2459642.291666667, , ,    42.30063,   24.16022,\n 2022-Mar-03 20:00, 2459642.333333333, , ,    42.33198,   24.18332,\n 2022-Mar-03 21:00, 2459642.375000000, , ,    42.36342,   24.20640,\n 2022-Mar-03 22:00, 2459642.416666667, , ,    42.39495,   24.22946,\n 2022-Mar-03 23:00, 2459642.458333333, , ,    42.42658,   24.25251,\n\n>..... Elevation Cut-off Requested .....<\n\n 2022-Mar-04 08:00, 2459642.833333333,*,m," &
                                "    42.71319,   24.46049,\n 2022-Mar-04 09:00, 2459642.875000000,*,m,    42.74491,   24.48366,\n 2022-Mar-04 10:00, 2459642.916666667,*,m,    42.77656,   24.50682,\n 2022-Mar-04 11:00, 2459642.958333333,*,m,    42.80813,   24.52996,\n 2022-Mar-04 12:00, 2459643.000000000,*,m,    42.83963,   24.55308,\n 2022-Mar-04 13:00, 2459643.041666667,*,m,    42.87108,   24.57616,\n 2022-Mar-04 14:00, 2459643.083333333,*,m,    42.90248,   24.59921,\n 2022-Mar-04 15:00, 2459643.125000000,*,m,    42.93386,   24.62221,\n 2022-Mar-04 16:00, 2459643.166666667,*,m,    42.96524,   24.64517,\n 2022-Mar-04 17:00, 2459643.208333333,*,m,    42.99664,   24.66809,\n 2022-Mar-04 18:00, 2459643.250000000,N,m,    43.02809,   24.69096,\n 2022-Mar-04 19:00, 2459643.291666667, ,m,    43.05960,   24.71380,\n 2022-Mar-04 20:00, 2459643.333333333, , ,    43.09118,   24.73660,\n 2022-Mar-04 21:00, 2459643.375000000, , ,    43.12285,   24.75938,\n 2022-Mar-04 22:00, 2459643.416666667, , ,    43.15462,   24.78214,\n 2022-Mar-04 23:00, 2459643.458333333, , ,    43.18648,   24.80489,\n\n>..... Elevation Cut-off Requested .....<\n\n 2022-Mar-05 08:00, 2459643.833333333,*,m,    43.47520,   25.01020,\n 2022-Mar-05 09:00, 2459643.875000000,*,m,    43.50716,   25.03307,\n 2022-Mar-05 10:00, 2459643.916666667,*,m,    43.53904,   25.05593,\n 2022-Mar-05 11:00, 2459643.958333333,*,m,    43.57084,   25.07877,\n 2022-Mar-05 12:00, 2459644.000000000,*,m,    43.60258,   25.10159,\n 2022-Mar-05 13:00, 2459644.041666667,*,m,    43.63426,   25.12438,\n 2022-Mar-05 14:00, 2459644.083333333,*,m,    43.66590,";
    pragma Style_Checks ("M120");

    Result : constant String := Os.Process.Execution_Of (Executable =>"D:\Request_Get",
                                                         Parameters => '"' & Url & '"');

  begin -- Result_Of_Get_With
    Log.Write ("URL<<<" & Url & ">>>");
    Log.Write ("GOT<<<" & Result & ">>>");
    return Data; -- Result
  end Result_Of_Get_With;

end Os.Horizon;
